% Chapter 19, Section 3

\section{Loopy Belief Propagation \difficultyInline{advanced}}
\label{sec:loopy-bp}

\subsection{Message Passing}

On graphical models, pass messages between nodes:
\begin{equation}
m_{i \to j}(x_j) = \sum_{x_i} \psi(x_i, x_j) \psi(x_i) \prod_{k \in N(i) \setminus j} m_{k \to i}(x_i)
\end{equation}

\subsection{Beliefs}

Compute marginals from messages:
\begin{equation}
b_i(x_i) \propto \psi(x_i) \prod_{j \in N(i)} m_{j \to i}(x_i)
\end{equation}

\subsection{Exact on Trees}

For tree-structured graphs, converges to exact marginals.

\subsection{Loopy Graphs}

On graphs with cycles:
\begin{itemize}
    \item May not converge
    \item Often gives good approximations
    \item Used in error-correcting codes, computer vision
\end{itemize}



% \subsection{Visual aids}
% \addcontentsline{toc}{subsubsection}{Visual aids (loopy BP)}

% \begin{figure}[h]
%   \centering
%   \begin{tikzpicture}
%     \begin{axis}[
%       width=0.48\textwidth,height=0.36\textwidth,
%       xlabel={Iteration}, ylabel={Residual}, ymode=log, grid=both]
%       \addplot[bookpurple,very thick] coordinates{(1,1.0) (2,0.5) (3,0.3) (4,0.2) (5,0.18)};
%       \addplot[bookred,very thick,dashed] coordinates{(1,1.0) (2,1.2) (3,1.4) (4,1.7) (5,2.0)};
%     \end{axis}
%   \end{tikzpicture}
%   \caption{Loopy BP: a convergent case (solid) vs. a divergent case (dashed), illustrative.}
%   \label{fig:lbp-conv}
% \end{figure}

% \subsection{Notes and references}

% For background and practical considerations, see \textcite{Bishop2006,GoodfellowEtAl2016,Prince2023}.

